<p-toast position="bottom-right" key="toast"></p-toast>



<div class="p-grid p-fluid">


    <div class="p-col-12 p-md-3 p-lg-3 ce-card-primary-top-outline ">
        <div class="card widget-task-list  p-shadow-2">
            <div class="p-col-12">
                <ng-container *ngIf="loading">

                    <p-skeleton styleClass="ce-center" shape="circle" size="10rem"></p-skeleton>
                    <p-skeleton width="10rem" styleClass="ce-center p-mt-2"></p-skeleton>
                    <p-skeleton width="100%" styleClass="ce-center p-mt-2" height="4rem"></p-skeleton>

                </ng-container>

                <ng-container *ngIf="!loading">
                    <img class="ce-profile-user-img ce-center" [src]="photo"/>
                    <h3 class="profile-username p-text-center">{{ens.nom_fr}} {{ens.prenom_fr}}</h3>


                    <p class=" p-text-center">

                        <app-enseignant-grade [grade]="ens?.enseignant_grade"></app-enseignant-grade>


                    </p>
                    <div class="">
                        <input #PDPInput (change)="onPDPChanged($event)" accept="image/*" type="file" hidden>
                        <p-button (click)="PDPInput.click()" icon="pi pi-image"
                                  label="Changer votre photo de profil"></p-button>
                    </div>
                </ng-container>


            </div>


        </div>
    </div>

    <div class="p-col-12 p-md-9 p-lg-9  ">
        <div class="card  p-shadow-2">
            <h5 *ngIf="!loading">{{lang.v21}}</h5>
            <p-skeleton *ngIf="loading" height="2.5rem" width="15rem" styleClass="p-mb-4"></p-skeleton>
            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">

                <div class="p-fluid p-formgrid p-grid">
                    <ng-container *ngIf="loading">

                        <div class="p-field p-col-12 p-md-6">
                            <p-skeleton width="8rem" styleClass="p-mb-2"></p-skeleton>
                            <p-skeleton height="2.5rem" styleClass="p-mb-2"></p-skeleton>
                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <p-skeleton width="8rem" styleClass="p-mb-2"></p-skeleton>
                            <p-skeleton height="2.5rem" styleClass="p-mb-2"></p-skeleton>
                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <p-skeleton width="8rem" styleClass="p-mb-2"></p-skeleton>
                            <p-skeleton height="2.5rem" styleClass="p-mb-2"></p-skeleton>
                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <p-skeleton width="8rem" styleClass="p-mb-2"></p-skeleton>
                            <p-skeleton height="2.5rem" styleClass="p-mb-2"></p-skeleton>
                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <p-skeleton width="8rem" styleClass="p-mb-2"></p-skeleton>
                            <p-skeleton height="2.5rem" styleClass="p-mb-2"></p-skeleton>
                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <p-skeleton width="8rem" styleClass="p-mb-2"></p-skeleton>
                            <p-skeleton height="2.5rem" styleClass="p-mb-2"></p-skeleton>
                        </div>
                        <div class="p-field p-col-12 p-md-2">
                            <p-skeleton height="4rem" styleClass="p-mb-2"></p-skeleton>
                        </div>

                    </ng-container>
                    <ng-container *ngIf="!loading">

                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.v22}} :</label>
                            <input formControlName="nom_fr" placeholder="{{lang.v22}}" type="text" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.nom_fr)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.v24}} :</label>
                            <input [matKeyboard]="'ar'" [darkTheme]="true" formControlName="nom_ar"
                                   placeholder="{{lang.v24}}" type="text" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.nom_ar)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.v23}} :</label>
                            <input formControlName="prenom_fr" placeholder="{{lang.v23}}" type="text" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.prenom_fr)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.v25}} :</label>
                            <input [matKeyboard]="'ar'" [darkTheme]="true" formControlName="prenom_ar"
                                   placeholder="{{lang.v25}}" type="text" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.prenom_ar)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>
                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.v28}} :</label>
                            <input formControlName="email" placeholder="{{lang.v28}}" type="email" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.email)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>

                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.v45}} :</label>
                            <input formControlName="email_institu" placeholder="{{lang.v45}}" type="email" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.email_institu)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>


                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.t_grade}} :</label>
                            <p-dropdown
                                optionLabel="label"
                                [options]="grades"
                                formControlName="enseignant_grade"></p-dropdown>
                            <p-message *ngIf="isValideInput(profileForm.controls.enseignant_grade)" severity="error"
                                       text="{{lang.t_grade}}"></p-message>

                        </div>

                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.doc_genre}} :</label>
                            <p-dropdown
                                optionLabel="label"
                                [options]="genres"
                                formControlName="genre"></p-dropdown>
                            <p-message *ngIf="isValideInput(profileForm.controls.genre)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>

                        <div class="p-field p-col-12 p-md-6">
                            <label class="">{{lang.v26}} :</label>
                            <input formControlName="date_naissance" placeholder="{{lang.v26}}" type="date" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.date_naissance)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>



                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.v27}} :</label>
                            <input formControlName="cin" placeholder="{{lang.v27}}" type="text" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.cin)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>


                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.t_ppr}} :</label>
                            <input formControlName="ppr" placeholder="{{lang.t_ppr}}" type="text" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.ppr)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>

                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.t_tel}} :</label>
                            <input formControlName="tel" placeholder="{{lang.t_tel}}" type="text" pInputText>
                            <p-message *ngIf="isValideInput(profileForm.controls.tel)" severity="error"
                                       text="{{lang.v12}}"></p-message>

                        </div>














                        <div class="p-col-12 ">
                            <div class="p-md-2 ce-fr">

                                <app-button [type]="'submit'" [icon]="'far fa-edit'"
                                            [block]="true" [text]="lang.v34"
                                            [loading]="isUpdating">
                                </app-button>
                            </div>
                        </div>


                    </ng-container>

                </div>
            </form>
        </div>

        <div class="card  p-mt-4 p-shadow-2">
            <h5 *ngIf="!loading">{{lang.reset_pwd}} :</h5>
            <p-skeleton *ngIf="loading" height="2.5rem" width="15rem" styleClass="p-mb-4"></p-skeleton>
            <form [formGroup]="passwordForm" (ngSubmit)="updatePwd()">
                <ng-container *ngIf="!loading">
                    <div class="p-fluid p-formgrid p-grid">
                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.new_pwd}}  :</label>
                            <input formControlName="new_password"
                                   placeholder="{{lang.new_pwd}}" type="text"
                                   pInputText>


                            <p-message  severity="info"
                                       text="{{lang.valide_pwd_length}}"></p-message>

                        </div>

                        <div class="p-field p-col-12 p-md-6">
                            <label>{{lang.new_pwd2}}  :</label>
                            <input formControlName="new_password2"
                                   placeholder="{{lang.new_pwd2}}" type="text"
                                   pInputText>


                        </div>
                    </div>


                    <div class="p-col-12 ">
                        <div class="p-md-2 ce-fr">
                            <app-button [type]="'submit'" [loading]="isUpdating" [icon]="'fa fa-undo'" [block]="true"
                                        [text]="lang.reinitialiser">
                            </app-button>
                        </div>
                    </div>
                </ng-container>

            </form>
        </div>
        <div class="card  p-mt-4 p-shadow-2" *ngIf="isAdminPedoc">
            <h5 *ngIf="!loading">{{lang.doc_sujet_info}} :</h5>
            <p-skeleton *ngIf="loading" height="2.5rem" width="15rem" styleClass="p-mb-4"></p-skeleton>


            <div class="p-fluid p-formgrid p-grid">


                <ng-container *ngIf="!loading">


                    <div class="p-field p-col-12">
                        <label>{{lang.t_nbr_sujets}} :</label>

                        <input  [(ngModel)]="sujetData.nbr_sujets"
                               placeholder="{{lang.t_nbr_sujets}}" type="number"
                               pInputText>

                    </div>
                    <div class="p-col-12 ">
                        <div class="p-md-2 ce-fr">

                            <app-button (click)="updateSujetProfile('nbr_sujets')" [class]="'ce-fr'" [type]="'submit'" [icon]="'far fa-edit'"
                                        [block]="true" [text]="lang.modifier"
                                        [loading]="isUpdating">
                            </app-button>
                        </div>
                    </div>


                    <div class="p-field p-col-12">
                        <label>{{lang.t_specialite}} :</label>
                        <p-multiSelect [(ngModel)]="sujetData.sps"
                                    [options]="sps"
                                    optionLabel="label"
                                    placeholder="{{lang.t_specialite}}"
                        ></p-multiSelect>
                    </div>
                    <div class="p-col-12 ">
                        <div class="p-md-2 ce-fr">

                            <app-button (click)="updateSujetProfile('sps')" [class]="'ce-fr'" [type]="'submit'" [icon]="'far fa-edit'"
                                        [block]="true" [text]="lang.modifier"
                                        [loading]="isUpdating">
                            </app-button>
                        </div>
                    </div>

                    <div class="p-field p-col-12">
                        <label>{{lang.t_cedoc}} :</label>
                        <p-dropdown [(ngModel)]="sujetData.cedoc"
                                    [options]="cedocs"
                                    optionLabel="label"
                                    placeholder="{{lang.t_cedoc}}"
                        ></p-dropdown>
                    </div>
                    <div class="p-col-12 ">
                        <div class="p-md-2 ce-fr">

                            <app-button (click)="updateSujetProfile('cedoc')" [class]="'ce-fr'" [type]="'submit'" [icon]="'far fa-edit'"
                                        [block]="true" [text]="lang.modifier"
                                        [loading]="isUpdating">
                            </app-button>
                        </div>
                    </div>

                    <div class="p-field p-col-12">
                        <label>{{lang.t_formation_doctorale}} :</label>
                        <p-dropdown [(ngModel)]="sujetData.fd"
                                    [options]="fds"
                                    optionLabel="label"
                                    placeholder="{{lang.t_formation_doctorale}}"
                        ></p-dropdown>
                    </div>
                    <div class="p-col-12 ">
                        <div class="p-md-2 ce-fr">

                            <app-button (click)="updateSujetProfile('fd')" [class]="'ce-fr'" [type]="'submit'" [icon]="'far fa-edit'"
                                        [block]="true" [text]="lang.modifier"
                                        [loading]="isUpdating">
                            </app-button>
                        </div>
                    </div>


                    <div class="p-field p-col-12">
                        <label>{{lang.t_labo}} :</label>
                        <p-dropdown [(ngModel)]="sujetData.labo"
                                    [options]="labos"
                                    optionLabel="label"
                                    placeholder="{{lang.t_labo}}"
                        ></p-dropdown>
                    </div>
                    <div class="p-col-12 ">
                        <div class="p-md-2 ce-fr">

                            <app-button (click)="updateSujetProfile('labo')" [class]="'ce-fr'" [type]="'submit'" [icon]="'far fa-edit'"
                                        [block]="true" [text]="lang.modifier"
                                        [loading]="isUpdating">
                            </app-button>
                        </div>
                    </div>

                    <div class="p-field p-col-12">
                        <label>{{lang.t_etab}} :</label>
                        <p-dropdown [(ngModel)]="sujetData.etab"
                                    [options]="etabs"
                                    optionLabel="label"
                                    placeholder="{{lang.t_etab}}"
                        ></p-dropdown>
                    </div>
                    <div class="p-col-12 ">
                        <div class="p-md-2 ce-fr">

                            <app-button (click)="updateSujetProfile('etab')" [class]="'ce-fr'" [type]="'submit'" [icon]="'far fa-edit'"
                                        [block]="true" [text]="lang.modifier"
                                        [loading]="isUpdating">
                            </app-button>
                        </div>
                    </div>



                </ng-container>

            </div>

        </div>
    </div>

</div>

<div class="p-grid p-fluid">

    <div class="p-col-12">
        <div class="card table-demo">

            <p-table #dt [value]="ens.encourssujets" dataKey="id"  [loading]="loading" [responsive]="true"
                     [lazy]="true"
                     styleClass="p-datatable-customers p-datatable-gridlines">
                <ng-template pTemplate="caption">

                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">

                        <h4>

                            {{ lang.sidemenu_docs_encadrement  }}

                        </h4>


                    </div>


                </ng-template>
                <ng-template pTemplate="header">
                    <tr>


                        <th [ngStyle]="{'width':'10%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">
                                {{lang.t_code_sujet}}

                            </div>
                        </th>
                        <th [ngStyle]="{'width':'30%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">
                                {{lang.t_sujet}}

                            </div>
                        </th>
                        <th [ngStyle]="{'width':'20%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">
                                {{lang.sujet_doctorants}}


                            </div>
                        </th>
                        <th [ngStyle]="{'width':'10%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">

                                {{lang.t_codirecteur}}

                            </div>
                        </th>

                        <th [ngStyle]="{'width':'10%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">

                                {{lang.t_type}}
                            </div>
                        </th>

                    </tr>


                </ng-template>

                <ng-template pTemplate="body" let-ob let-expanded="expanded">
                    <tr>
                        <td>
                            <span class="p-column-title">{{lang.t_code_sujet}}:</span>

                            {{ob.code_sujet}}

                        </td>
                             <td>
                            <span class="p-column-title">{{lang.t_sujet}}:</span>

                            {{ob.intitule_fr}}




                        </td>


                        <td>
                            <span class="p-column-title">{{lang.t_doctorants}}:</span>
                            {{ob.doctorants[0].nom_fr}} {{ob.doctorants[0].prenom_fr}}
                            <br>
                            <i class="fas fa-phone-alt ce-sub_title "> {{ob.doctorants[0].tel}}</i>
                            <br>
                            <i class="fas fa-at ce-sub_title "> {{ob.doctorants[0].email}}</i>
                        </td>

                        <td>
                            <span class="p-column-title">{{lang.t_codirecteur}}:</span>

                            <div *ngIf="!ob.codirecteur">-</div>
                            <ng-container *ngIf="ob.codirecteur">


                                <div > {{ob.codirecteur.label}}

                                    <B *ngIf="ob.is_externe_codirecteur" style="color: red;">({{lang.sujet_externe}})</B>
                                </div>

                            </ng-container>



                        </td>




                        <td>
                            <span class="p-column-title">{{lang.t_type}}:</span>

                            <p-tag *ngIf="ob.is_cotutelle" severity="success" value="{{lang.sujet_add_type_cotutelle_fr}}"></p-tag>
                            <p-tag *ngIf="ob.is_projet" severity="info" value="{{lang.sujet_add_type_projet_fr}}"></p-tag>
                            <p-tag *ngIf="!ob.is_projet && !ob.is_cotutelle" severity="danger" value="{{lang.sujet_add_type_normale_fr}}"></p-tag>


                        </td>



                    </tr>
                </ng-template>


                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="7">{{lang.t_aucun_sujet}}.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

    </div>


</div>


<div class="p-grid p-fluid">

    <div class="p-col-12">
        <div class="card table-demo">

            <p-table #dt [value]="ens.encourscosujets" dataKey="id"  [loading]="loading" [responsive]="true"
                     [lazy]="true"
                     styleClass="p-datatable-customers p-datatable-gridlines">
                <ng-template pTemplate="caption">

                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">

                        <h4>

                            {{ lang.sidemenu_docs_coencadrement  }}

                        </h4>


                    </div>


                </ng-template>
                <ng-template pTemplate="header">
                    <tr>


                        <th [ngStyle]="{'width':'10%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">
                                {{lang.t_code_sujet}}

                            </div>
                        </th>
                        <th [ngStyle]="{'width':'30%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">
                                {{lang.t_sujet}}

                            </div>
                        </th>
                        <th [ngStyle]="{'width':'20%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">
                                {{lang.sujet_doctorants}}


                            </div>
                        </th>
                        <th [ngStyle]="{'width':'10%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">

                                {{lang.t_directeur}}

                            </div>
                        </th>

                        <th [ngStyle]="{'width':'10%'}">
                            <div class="p-d-flex p-jc-between p-ai-center">

                                {{lang.t_type}}
                            </div>
                        </th>

                    </tr>


                </ng-template>

                <ng-template pTemplate="body" let-ob let-expanded="expanded">
                    <tr>
                        <td>
                            <span class="p-column-title">{{lang.t_code_sujet}}:</span>

                            {{ob.code_sujet}}

                        </td>
                             <td>
                            <span class="p-column-title">{{lang.t_sujet}}:</span>

                            {{ob.intitule_fr}}




                        </td>


                        <td>
                            <span class="p-column-title">{{lang.t_doctorants}}:</span>
                            {{ob.doctorants[0].nom_fr}} {{ob.doctorants[0].prenom_fr}}
                            <br>
                            <i class="fas fa-phone-alt ce-sub_title "> {{ob.doctorants[0].tel}}</i>
                            <br>
                            <i class="fas fa-at ce-sub_title "> {{ob.doctorants[0].email}}</i>
                        </td>

                        <td>
                            <span class="p-column-title">{{lang.t_directeur}}:</span>



                                <div > {{ob.directeur.label}}

                                </div>





                        </td>




                        <td>
                            <span class="p-column-title">{{lang.t_type}}:</span>

                            <p-tag *ngIf="ob.is_cotutelle" severity="success" value="{{lang.sujet_add_type_cotutelle_fr}}"></p-tag>
                            <p-tag *ngIf="ob.is_projet" severity="info" value="{{lang.sujet_add_type_projet_fr}}"></p-tag>
                            <p-tag *ngIf="!ob.is_projet && !ob.is_cotutelle" severity="danger" value="{{lang.sujet_add_type_normale_fr}}"></p-tag>


                        </td>



                    </tr>
                </ng-template>


                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="7">{{lang.t_aucun_sujet}}.</td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

    </div>


</div>

